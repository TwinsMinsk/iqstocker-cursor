"""Initialize stocker calendar according to Tะ."""

from datetime import datetime, timezone
from sqlalchemy.orm import Session
from config.database import SessionLocal
from database.models import CalendarEntry


def create_calendar_entries():
    """Create calendar entries according to Tะ section 9."""
    
    db = SessionLocal()
    try:
        # Check if calendar entries already exist
        existing_entries = db.query(CalendarEntry).count()
        if existing_entries > 0:
            print(f"Calendar entries already exist ({existing_entries} entries)")
            return
        
        # Get current month
        now = datetime.now(timezone.utc)
        current_month = now.month
        current_year = now.year
        
        # Create calendar entry for current month
        calendar_entry = CalendarEntry(
            month=current_month,
            year=current_year,
            description=f"ะะฐะปะตะฝะดะฐัั ััะพะบะตัะฐ ะฝะฐ {_get_month_name_ru(current_month)}",
            load_now_themes=_get_load_now_themes(current_month),
            prepare_themes=_get_prepare_themes(current_month),
            created_at=now
        )
        
        db.add(calendar_entry)
        db.commit()
        
        print(f"Created calendar entry for {_get_month_name_ru(current_month)} {current_year}")
        print(f"Load now themes: {len(calendar_entry.load_now_themes)}")
        print(f"Prepare themes: {len(calendar_entry.prepare_themes)}")
        
    except Exception as e:
        print(f"Error creating calendar entries: {e}")
        db.rollback()
    finally:
        db.close()


def _get_month_name_ru(month: int) -> str:
    """Get Russian month name."""
    months = {
        1: "ะฏะฝะฒะฐัั", 2: "ะคะตะฒัะฐะปั", 3: "ะะฐัั", 4: "ะะฟัะตะปั",
        5: "ะะฐะน", 6: "ะัะฝั", 7: "ะัะปั", 8: "ะะฒะณััั",
        9: "ะกะตะฝััะฑัั", 10: "ะะบััะฑัั", 11: "ะะพัะฑัั", 12: "ะะตะบะฐะฑัั"
    }
    return months.get(month, "ะะตะธะทะฒะตััะฝัะน ะผะตััั")


def _get_season_description(month: int) -> str:
    """Get season description based on month."""
    if month in [12, 1, 2]:
        return "ะะธะผะฐ โ ะฒัะตะผั ัััะฝัั ััะถะตัะพะฒ, ะฟัะฐะทะดะฝะธะบะพะฒ ะธ ะทะธะผะฝะธั ะฐะบัะธะฒะฝะพััะตะน. ะะดะตะฐะปัะฝะพ ะดะปั ัะพะทะดะฐะฝะธั ะฐัะผะพััะตัะฝัั ัะฐะฑะพั."
    elif month in [3, 4, 5]:
        return "ะะตัะฝะฐ โ ะฟะตัะธะพะด ะพะฑะฝะพะฒะปะตะฝะธั ะธ ัะพััะฐ. ะัะปะธัะฝะพะต ะฒัะตะผั ะดะปั ััะตะผะบะธ ะฟัะธัะพะดั, ะฝะพะฒัั ะฝะฐัะธะฝะฐะฝะธะน ะธ ะฒะตัะตะฝะฝะธั ะฟัะฐะทะดะฝะธะบะพะฒ."
    elif month in [6, 7, 8]:
        return "ะะตัะพ โ ะณะพัััะธะน ัะตะทะพะฝ ะดะปั ััะพะบะพะฒ! ะะฝะพะณะพ ะฐะบัะธะฒะฝะพััะตะน ะฝะฐ ัะฒะตะถะตะผ ะฒะพะทะดััะต, ะพัะฟััะบะพะฒ ะธ ะปะตัะฝะธั ะฟัะฐะทะดะฝะธะบะพะฒ."
    else:  # 9, 10, 11
        return "ะัะตะฝั โ ะณะพัััะธะน ัะตะทะพะฝ ะดะปั ััะพะบะพะฒ: ะผะฝะพะณะพ ะฟัะฐะทะดะฝะธะบะพะฒ, ัััะฝัั ััะถะตัะพะฒ ะธ ะฟะตัะฒัั ะทะธะผะฝะธั ะทะฐะณะพัะพะฒะพะบ."


def _get_load_now_themes(month: int) -> list:
    """Get themes to load now based on month."""
    themes_by_month = {
        1: ["๐ ะะพะฒะพะณะพะดะฝะธะต ะฟัะฐะทะดะฝะธะบะธ", "โ๏ธ ะะธะผะฝะธะต ััะตะฝั", "๐๏ธ ะะธะผะฝะธะน ัะฟะพัั", "โ ะฃััะฝัะต ะผะพะผะตะฝัั"],
        2: ["๐ ะะตะฝั ะกะฒััะพะณะพ ะะฐะปะตะฝัะธะฝะฐ", "โ๏ธ ะะธะผะฝะธะต ะฟะตะนะทะฐะถะธ", "๐ ะะพะผะฐัะฝะธะน ััั", "๐ ะะฑัะฐะทะพะฒะฐะฝะธะต"],
        3: ["๐ธ ะะตัะตะฝะฝะธะต ััะตะฝั", "๐ฑ ะัะธัะพะดะฐ ะฟัะพะฑัะถะดะฐะตััั", "๐ ะัะฟััะบะฝัะต", "๐ ะะตัะตะฝะฝะธะต ะฐะบัะธะฒะฝะพััะธ"],
        4: ["๐ฐ ะะฐััะฐ", "๐ธ ะะตัะตะฝะฝะธะต ัะฒะตัั", "๐ฑ ะกะฐะดะพะฒะพะดััะฒะพ", "๐ ะะตัะตะฝะฝะธะน ัะฟะพัั"],
        5: ["๐ฉ ะะตะฝั ะผะฐัะตัะธ", "๐ธ ะะตัะตะฝะฝะธะต ะฟัะฐะทะดะฝะธะบะธ", "๐ฑ ะกะฐะดะพะฒะพะดััะฒะพ", "๐ ะะตัะตะฝะฝะธะต ะฐะบัะธะฒะฝะพััะธ"],
        6: ["๐จ ะะตะฝั ะพััะฐ", "โ๏ธ ะะตัะฝะธะต ััะตะฝั", "๐๏ธ ะัะฟััะบ", "๐ป ะะตัะฝะธะต ัะฒะตัั"],
        7: ["๐บ๐ธ ะะตะฝั ะฝะตะทะฐะฒะธัะธะผะพััะธ", "โ๏ธ ะะตัะฝะธะต ะฐะบัะธะฒะฝะพััะธ", "๐๏ธ ะะปัะถ", "๐ป ะะตัะฝะธะต ะฟัะฐะทะดะฝะธะบะธ"],
        8: ["๐๏ธ ะะตัะฝะธะน ะพัะดัั", "โ๏ธ ะะตัะฝะธะต ััะตะฝั", "๐ป ะะตัะฝะธะต ัะฒะตัั", "๐ ะะตัะฝะธะน ัะฟะพัั"],
        9: ["๐ ะะฐัะฐะปะพ ััะตะฑะฝะพะณะพ ะณะพะดะฐ", "๐ ะัะตะฝะฝะธะต ััะตะฝั", "๐ ะกะฑะพั ััะพะถะฐั", "๐ ะัะตะฝะฝะธะต ะฐะบัะธะฒะฝะพััะธ"],
        10: ["๐ ะฅัะปะปะพัะธะฝ", "๐ ะัะตะฝะฝะธะต ััะตะฝั", "๐ ะกะฑะพั ััะพะถะฐั", "๐๏ธ ะัะตะฝะฝะธะต ัะฐัะฟัะพะดะฐะถะธ"],
        11: ["๐ฆ ะะตะฝั ะฑะปะฐะณะพะดะฐัะตะฝะธั", "๐ ะัะตะฝะฝะธะต ััะตะฝั", "๐๏ธ ะงะตัะฝะฐั ะฟััะฝะธัะฐ", "๐ ะกะฑะพั ััะพะถะฐั"],
        12: ["๐ ะะพะถะดะตััะฒะพ", "โ๏ธ ะะธะผะฝะธะต ััะตะฝั", "๐ ะะพะดะฐัะบะธ", "โ ะัะฐะทะดะฝะธัะฝะฐั ะฐัะผะพััะตัะฐ"]
    }
    return themes_by_month.get(month, ["๐ฏ ะะฑัะธะต ัะตะผั"])


def _get_prepare_themes(month: int) -> list:
    """Get themes to prepare for next 1-2 months."""
    themes_by_month = {
        1: ["๐ ะะตะฝั ะกะฒััะพะณะพ ะะฐะปะตะฝัะธะฝะฐ", "๐ธ ะะตัะตะฝะฝะธะต ััะตะฝั", "๐ ะะฑัะฐะทะพะฒะฐะฝะธะต", "๐ฑ ะัะธัะพะดะฐ"],
        2: ["๐ธ ะะตัะตะฝะฝะธะต ััะตะฝั", "๐ฐ ะะฐััะฐ", "๐ฑ ะกะฐะดะพะฒะพะดััะฒะพ", "๐ ะะตัะตะฝะฝะธะต ะฐะบัะธะฒะฝะพััะธ"],
        3: ["๐ฐ ะะฐััะฐ", "๐ธ ะะตัะตะฝะฝะธะต ัะฒะตัั", "๐ฑ ะกะฐะดะพะฒะพะดััะฒะพ", "๐ฉ ะะตะฝั ะผะฐัะตัะธ"],
        4: ["๐ฉ ะะตะฝั ะผะฐัะตัะธ", "๐ธ ะะตัะตะฝะฝะธะต ะฟัะฐะทะดะฝะธะบะธ", "๐ฑ ะกะฐะดะพะฒะพะดััะฒะพ", "๐จ ะะตะฝั ะพััะฐ"],
        5: ["๐จ ะะตะฝั ะพััะฐ", "โ๏ธ ะะตัะฝะธะต ััะตะฝั", "๐๏ธ ะัะฟััะบ", "๐ป ะะตัะฝะธะต ัะฒะตัั"],
        6: ["โ๏ธ ะะตัะฝะธะต ะฐะบัะธะฒะฝะพััะธ", "๐๏ธ ะะปัะถ", "๐ป ะะตัะฝะธะต ะฟัะฐะทะดะฝะธะบะธ", "๐บ๐ธ ะะตะฝั ะฝะตะทะฐะฒะธัะธะผะพััะธ"],
        7: ["๐๏ธ ะะตัะฝะธะน ะพัะดัั", "โ๏ธ ะะตัะฝะธะต ััะตะฝั", "๐ป ะะตัะฝะธะต ัะฒะตัั", "๐ ะะฐัะฐะปะพ ััะตะฑะฝะพะณะพ ะณะพะดะฐ"],
        8: ["๐ ะะฐัะฐะปะพ ััะตะฑะฝะพะณะพ ะณะพะดะฐ", "๐ ะัะตะฝะฝะธะต ััะตะฝั", "๐ ะกะฑะพั ััะพะถะฐั", "๐ ะฅัะปะปะพัะธะฝ"],
        9: ["๐ ะฅัะปะปะพัะธะฝ", "๐ ะัะตะฝะฝะธะต ััะตะฝั", "๐ฆ ะะตะฝั ะฑะปะฐะณะพะดะฐัะตะฝะธั", "๐๏ธ ะงะตัะฝะฐั ะฟััะฝะธัะฐ"],
        10: ["๐ฆ ะะตะฝั ะฑะปะฐะณะพะดะฐัะตะฝะธั", "๐๏ธ ะงะตัะฝะฐั ะฟััะฝะธัะฐ", "๐ ะะพะถะดะตััะฒะพ", "โ๏ธ ะะธะผะฝะธะต ััะตะฝั"],
        11: ["๐ ะะพะถะดะตััะฒะพ", "โ๏ธ ะะธะผะฝะธะต ััะตะฝั", "๐ ะะพะดะฐัะบะธ", "โ ะัะฐะทะดะฝะธัะฝะฐั ะฐัะผะพััะตัะฐ"],
        12: ["๐ ะะตะฝั ะกะฒััะพะณะพ ะะฐะปะตะฝัะธะฝะฐ", "โ๏ธ ะะธะผะฝะธะต ััะตะฝั", "๐๏ธ ะะธะผะฝะธะน ัะฟะพัั", "โ ะฃััะฝัะต ะผะพะผะตะฝัั"]
    }
    return themes_by_month.get(month, ["๐ฏ ะะฑัะธะต ัะตะผั"])


if __name__ == "__main__":
    create_calendar_entries()
