"""Fixed report generator according to T–ó."""

from datetime import datetime
from typing import Dict, Any
from core.analytics.advanced_csv_processor import AdvancedProcessResult

class FixedReportGenerator:
    """Fixed report generator that follows T–ó requirements."""
    
    def generate_monthly_report(self, result: AdvancedProcessResult) -> str:
        """Generate monthly report according to T–ó."""
        
        # Format period
        period_text = result.period_human_ru
        
        # Main indicators
        main_indicators = f"""üìä **–û–¢–ß–Å–¢ –ó–ê –ú–ï–°–Ø–¶ –ì–û–¢–û–í!**

üè¢ **–û–°–ù–û–í–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:**
‚Ä¢ –ü—Ä–æ–¥–∞–∂: {result.rows_used}
‚Ä¢ –î–æ—Ö–æ–¥: ${result.total_revenue_usd:.2f}
‚Ä¢ % –ø–æ—Ä—Ç—Ñ–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–¥–∞–ª—Å—è: {result.portfolio_sold_percent:.1f}%
‚Ä¢ –î–æ–ª—è –ø—Ä–æ–¥–∞–∂ –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç: {result.new_works_sales_percent:.1f}%"""
        
        # Additional indicators
        additional_indicators = f"""
üìà **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:**
‚Ä¢ % –ø—Ä–∏–µ–º–∫–∏: {result.acceptance_rate:.0f}%
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {result.upload_limit_usage:.1f}%"""
        
        # Interpretations
        interpretations = self._generate_interpretations(result)
        
        # Combine all parts
        full_report = main_indicators + additional_indicators + interpretations
        
        return full_report
    
    def _generate_interpretations(self, result: AdvancedProcessResult) -> str:
        """Generate interpretations according to T–ó."""
        
        interpretations = f"""

üìä **–ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:**

üÜï **–ù–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã ({result.new_works_sales_percent:.1f}%):**"""
        
        # New works interpretation
        if result.new_works_sales_percent == 100:
            interpretations += f"\n–ï—Å–ª–∏ —Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª –≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –≤—Å—ë –≤–ø–µ—Ä–µ–¥–∏, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π. –ù–æ –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–∞–µ—à—å –Ω–æ–≤–æ–µ —É–∂–µ 3+ –º–µ—Å—è—Ü–∞, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç: –ü–æ—Å–º–æ—Ç—Ä–∏ **–æ–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã**, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –≤ —á–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏."
        elif result.new_works_sales_percent >= 30:
            interpretations += f"\n–£ —Ç–µ–±—è –≤—Å—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –≤—ã—Å—Ç—Ä–æ–µ–Ω–æ. –ù–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –∑–∞—Ö–æ–¥—è—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π –æ–±—ä–µ–º –∑–∞–≥—Ä—É–∑–∫–∏."
        elif 20 <= result.new_works_sales_percent < 30:
            interpretations += f"\n–û—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü—Ä–æ–¥–æ–ª–∂–∞–π –≥—Ä—É–∑–∏—Ç—å –≤ —Ç–æ–º –∂–µ –∫–∞—á–µ—Å—Ç–≤–µ. –î–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ —Ç–µ–º—ã."
        elif 10 <= result.new_works_sales_percent < 20:
            interpretations += f"\n–ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—à—ë–ª –≤ –ø—Ä–æ–¥–∞–∂–∏, —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π –∑–Ω–∞–∫. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –£–≤–µ–ª–∏—á—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–º, —á—Ç–æ–±—ã –ø—Ä–∏–≤–ª–µ—á—å –Ω–æ–≤—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π."
        else:
            interpretations += f"\n–ï—Å–ª–∏ —Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª –≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –≤—Å—ë –≤–ø–µ—Ä–µ–¥–∏, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π. –ù–æ –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–∞–µ—à—å –Ω–æ–≤–æ–µ —É–∂–µ 3+ –º–µ—Å—è—Ü–∞, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç: –ü–æ—Å–º–æ—Ç—Ä–∏ **–æ–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã**, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –≤ —á–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏."
        
        # Portfolio interpretation
        interpretations += f"""

üìà **–ü–æ—Ä—Ç—Ñ–µ–ª—å ({result.portfolio_sold_percent:.1f}%):**"""
        
        if result.portfolio_sold_percent < 1:
            interpretations += f"\n–ï—Å–ª–∏ —Ç—ã —Ç–æ–ª—å–∫–æ –Ω–µ–¥–∞–≤–Ω–æ –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É –Ω–∞ —Å—Ç–æ–∫–∞—Ö - –≤—Å–µ –æ–∫. –î–∞–π –ø–æ—Ä—Ç—Ñ–µ–ª—é –≤—Ä–µ–º—è. –ù–æ –µ—Å–ª–∏ —Ç—ã –Ω–∞ —Å—Ç–æ–∫–∞—Ö —É–∂–µ –¥–∞–≤–Ω–æ - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞."
        elif 1 <= result.portfolio_sold_percent < 2:
            interpretations += f"\n–ü—Ä–æ–¥–∞–∂–∏ –µ—Å—Ç—å, –Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Ä–∞—Å–∫—Ä—ã—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–æ–±–µ–π —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞..."
        elif 2.01 <= result.portfolio_sold_percent < 3:
            interpretations += f"\n–¢—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏! –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ. –î–æ–±–∞–≤–ª—è–π –±–æ–ª—å—à–µ —Ç–µ–º..."
        elif 3 <= result.portfolio_sold_percent < 5:
            interpretations += f"\n–£ —Ç–µ–±—è —Å–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π; —É–≤–µ–ª–∏—á–∏–≤–∞–π –æ–±—ä–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏..."
        else:
            interpretations += f"\n–†–∞–±–æ—Ç—ã üî•, –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø—Ä–æ–¥–∞—ë—Ç—Å—è –º–æ—â–Ω–æ. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–æ–¥–Ω–∏–º–∞–π –æ–±—ä—ë–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–µ–∫—É—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ..."
        
        # Acceptance interpretation
        interpretations += f"""

‚úÖ **–ü—Ä–∏–µ–º–∫–∞ ({result.acceptance_rate:.0f}%):**"""
        
        if result.acceptance_rate < 30:
            interpretations += f"\n–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–∞–±—ã–π. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–æ—Å–º–æ—Ç—Ä–∏ –æ–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ –∏ —Ä–∞–∑–±–µ—Ä–∏—Å—å, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–∫–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ..."
        elif 31 <= result.acceptance_rate < 50:
            interpretations += f"\n–ï—Å—Ç—å –Ω–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏ —É—á–µ–±–Ω—ã–µ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏, —á—Ç–æ–±—ã –ø–æ–¥—Ç—è–Ω—É—Ç—å —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞..."
        elif 50 <= result.acceptance_rate < 55:
            interpretations += f"\n–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, —Å –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞–≤—Ç–æ—Ä–æ–≤. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü—Ä–æ–¥–æ–ª–∂–∞–π –≥—Ä—É–∑–∏—Ç—å, –Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–º–æ—Ç—Ä–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É..."
        elif 55 <= result.acceptance_rate < 65:
            interpretations += f"\n–£ —Ç–µ–±—è —Å–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π —Ç–µ–∫—É—â–∏–µ —É–¥–∞—á–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
        else:
            interpretations += f"\n–¢–∞–∫–∞—è –ø—Ä–∏–µ–º–∫–∞ —Å–µ–π—á–∞—Å –¥–∞–ª–µ–∫–æ –Ω–µ —É –≤—Å–µ—Ö. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∫–∞—á–µ—Å—Ç–≤–æ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–π –æ–±—ä—ë–º..."
        
        # Upload limit interpretation
        interpretations += f"""

üì§ **–õ–∏–º–∏—Ç –∑–∞–≥—Ä—É–∑–∫–∏ ({result.upload_limit_usage:.1f}%):**"""
        
        if result.upload_limit_usage <= 30:
            interpretations += f"\n–¢—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–≤–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ó–∞–≥—Ä—É–∂–∞–π –±–æ–ª—å—à–µ..."
        elif 30 < result.upload_limit_usage <= 60:
            interpretations += f"\n–•–æ—Ä–æ—à–µ–µ –Ω–∞—á–∞–ª–æ, –Ω–æ –ø–æ–∫–∞ –Ω–µ –¥–æ—Ç—è–≥–∏–≤–∞–µ—à—å –¥–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –°—Ç–∞–≤—å —Ü–µ–ª—å —Ö–æ—Ç—è –±—ã 70‚Äì80% –ª–∏–º–∏—Ç–∞..."
        elif 60 < result.upload_limit_usage <= 80:
            interpretations += f"\n–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ —Ö–æ—Ä–æ—à–µ–º —Ç–µ–º–ø–µ, –Ω–æ –µ—Å—Ç—å –∑–∞–ø–∞—Å –¥–ª—è —Ä–æ—Å—Ç–∞. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –î–æ—Ç—è–Ω–∏ –¥–æ –º–∞–∫—Å–∏–º—É–º–∞ –ª–∏–º–∏—Ç–∞..."
        elif 80 < result.upload_limit_usage <= 95:
            interpretations += f"\n–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç—ã –±–ª–∏–∑–∫–æ –∫ –º–∞–∫—Å–∏–º—É–º—É. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –î–æ–±–µ–π –ª–∏–º–∏—Ç, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–∞–±–æ—Ç 100%."
        else:
            interpretations += f"\n–¢—ã –≤—ã–∂–∞–ª –∏–∑ –ª–∏–º–∏—Ç–∞ –≤—Å—ë, —á—Ç–æ –º–æ–∂–Ω–æ. –ß—Ç–æ –¥–µ–ª–∞—Ç—å: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ç–∞–∫—É—é —Å–∏—Å—Ç–µ–º—É –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –¥–∞–ª—å—à–µ."
        
        # Conclusion
        interpretations += f"""

–≠—Ç–æ –±—ã–ª –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Ç–≤–æ–µ–º—É –ø–æ—Ä—Ç—Ñ–µ–ª—é –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∑–∞ –¥—Ä—É–≥–æ–π –º–µ—Å—è—Ü ‚Äî –ø—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –ª–∏–º–∏—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏ –∑–∞–≥—Ä—É–∑–∏ –Ω–æ–≤—ã–π CSV-—Ñ–∞–π–ª.
–ü–æ–∫–∞ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Å—è –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ. –ü–æ—Å–º–æ—Ç—Ä–∏ –æ–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —á—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å.
–°–ª–µ–¥–∏ –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π - —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–µ—Å—è—Ü–µ–≤ —É–∂–µ –±—É–¥—É—Ç –ø–µ—Ä–≤—ã–µ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Ç—ã —É–∑–Ω–∞–µ—à—å –Ω–∞–¥–æ –ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –≤ —Ä–∞–±–æ—Ç–µ."""
        
        return interpretations
    
    def generate_top_themes_report(self, result: AdvancedProcessResult, subscription_type: str) -> str:
        """Generate top themes report."""
        
        period_text = result.period_human_ru
        
        if result.top10_by_revenue.empty:
            return f"""üèÜ **–¢–û–ü –¢–ï–ú –ü–û –ü–†–û–î–ê–ñ–ê–ú –ò –î–û–•–û–î–£**

–ê–Ω–∞–ª–∏–∑ –∑–∞ {period_text}:
–¢–æ–ø —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
–¢–æ–ø —Ç–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.

‚ùóÔ∏è –í—Å–µ —Ç–æ–ø-—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –¢—ã –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –º–æ–∂–µ—à—å –∑–∞–π—Ç–∏ —Å—é–¥–∞, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö.

üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Ç–µ–º—ã –≤ —Å–≤–æ–∏—Ö –±—É–¥—É—â–∏—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Ö –∏ —Å—ä–µ–º–∫–∞—Ö ‚Äî –æ–Ω–∏ —É–∂–µ –¥–æ–∫–∞–∑–∞–ª–∏ —Å–≤–æ—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –Ω–∞ –Ω–∏—Ö –µ—â–µ –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç."""
        
        # Determine how many themes to show
        if subscription_type == "PRO":
            themes_to_show = min(5, len(result.top10_by_revenue))
            themes_text = "**–¢–æ–ø-5 —Ç–µ–º:**"
        else:  # ULTRA
            themes_to_show = min(10, len(result.top10_by_revenue))
            themes_text = "**–¢–æ–ø-10 —Ç–µ–º:**"
        
        # Format themes
        themes_list = []
        for i, (_, row) in enumerate(result.top10_by_revenue.head(themes_to_show).iterrows(), 1):
            themes_list.append(
                f"{i}. {row['asset_title']} ‚Äî {int(row['total_sales'])} –ø—Ä–æ–¥–∞–∂/{float(row['total_revenue']):.2f}$"
            )
        
        return f"""üèÜ **–¢–û–ü –¢–ï–ú –ü–û –ü–†–û–î–ê–ñ–ê–ú –ò –î–û–•–û–î–£**

–ê–Ω–∞–ª–∏–∑ –∑–∞ {period_text}:

{themes_text}
{chr(10).join(themes_list)}

‚ùóÔ∏è –í—Å–µ —Ç–æ–ø-—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –¢—ã –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –º–æ–∂–µ—à—å –∑–∞–π—Ç–∏ —Å—é–¥–∞, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö.

üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Ç–µ–º—ã –≤ —Å–≤–æ–∏—Ö –±—É–¥—É—â–∏—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Ö –∏ —Å—ä–µ–º–∫–∞—Ö ‚Äî –æ–Ω–∏ —É–∂–µ –¥–æ–∫–∞–∑–∞–ª–∏ —Å–≤–æ—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –Ω–∞ –Ω–∏—Ö –µ—â–µ –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç."""

