# –£–ª—É—á—à–µ–Ω–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Limits

## –î–∞—Ç–∞: 26 –æ–∫—Ç—è–±—Ä—è 2025

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `theme_cooldown_days` –≤ –º–æ–¥–µ–ª—å Limits

**–§–∞–π–ª:** `database/models/limits.py`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `theme_cooldown_days: Mapped[int]` —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 –¥–Ω–µ–π
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω `themes_total` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å 0 –Ω–∞ 4 (4 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –º–µ—Å—è—Ü = 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

### 2. –£–ª—É—á—à–µ–Ω–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å Limits

**–§–∞–π–ª:** `scripts/runners/admin_fastapi.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `theme_cooldown_days` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cooldown –ø–µ—Ä–∏–æ–¥–∞
- ‚úÖ –§–æ—Ä–º–∞—Ç–µ—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
  - `themes_used`: "X –∏–∑ Y" (–Ω–∞–ø—Ä–∏–º–µ—Ä "1 –∏–∑ 4")
  - `analytics_used`: "X –∏–∑ Y"
  - `theme_cooldown_days`: "X –¥–Ω–µ–π (Y –Ω–µ–¥–µ–ª—å)"
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–µ–π (`column_descriptions`) –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å cooldown —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
- ‚úÖ Eager loading –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è DetachedInstanceError

**–ü–æ–¥–ø–∏—Å–∏ –∫–æ–ª–æ–Ω–æ–∫:**
- "Analytics Limit" / "Analytics Used"
- "Themes Limit (per month)" / "Themes Used"
- "Theme Cooldown (days)"
- "Last Theme Request"

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è cooldown

**–§–∞–π–ª:** `core/theme_settings.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ `get_theme_cooldown_days(user_id)` - —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç cooldown –∏–∑ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `get_theme_cooldown_days_sync(user_id)` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ Fallback –Ω–∞ DEFAULT_THEME_COOLDOWN_DAYS = 7 –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ë–î
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏ `Limits`

### 4. –û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–º

**–§–∞–π–ª:** `bot/handlers/themes.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –í—ã–∑–æ–≤ `get_theme_cooldown_days_sync(user.id)` —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç user_id
- ‚úÖ Cooldown —Ç–µ–ø–µ—Ä—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –õ–∏–º–∏—Ç—ã –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–º

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- üìä **4 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –º–µ—Å—è—Ü** (themes_total = 4)
- ‚è±Ô∏è **7 –¥–Ω–µ–π –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º–∏** (theme_cooldown_days = 7)
- üìà **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**: "1 –∏–∑ 4", "2 –∏–∑ 4" –∏ —Ç.–¥.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ:**
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ `/admin/limits/list`
2. –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è:
   - `Themes Limit (per month)` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - `Theme Cooldown (days)` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –º–µ–∂–¥—É –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º–∏
   - `Themes Used` - —Å–∫–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ:**
- themes_total = 4
- theme_cooldown_days = 7
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ –Ω–µ–¥–µ–ª—é, 4 –≤ –º–µ—Å—è—Ü

**–ü—Ä–µ–º–∏—É–º —Ç–∞—Ä–∏—Ñ (–ø—Ä–∏–º–µ—Ä):**
- themes_total = 8
- theme_cooldown_days = 3
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 3 –¥–Ω—è, 8 –≤ –º–µ—Å—è—Ü

**VIP —Ç–∞—Ä–∏—Ñ (–ø—Ä–∏–º–µ—Ä):**
- themes_total = 30
- theme_cooldown_days = 1
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ –¥–µ–Ω—å, 30 –≤ –º–µ—Å—è—Ü

## –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `database/migrations/versions/b241e3487fd2_add_theme_cooldown_days_to_limits.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `theme_cooldown_days INTEGER DEFAULT 7` –≤ —Ç–∞–±–ª–∏—Ü—É `limits`
- –ú–∏–≥—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ ‚úÖ

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–µ–ø–µ—Ä—å –ø–æ–∑–≤–æ–ª—è–µ—Ç:**
1. –í–∏–¥–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "X –∏–∑ Y"
2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π cooldown –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Ç–µ–º –≤ –º–µ—Å—è—Ü
4. –í–∏–¥–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å —Ç–µ–º

‚úÖ **–ë–æ—Ç —Ç–µ–ø–µ—Ä—å:**
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π cooldown –∏–∑ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 4 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –º–µ—Å—è—Ü –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

‚úÖ **0 –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞**

