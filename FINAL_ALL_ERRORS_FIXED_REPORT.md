# üéâ –í–°–ï –û–®–ò–ë–ö–ò –ò–ó –õ–û–ì–û–í –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–´!

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤ –ª–æ–≥–∞—Ö:

### 1. –û—à–∏–±–∫–∞ –≤ `start.py` —Å—Ç—Ä–æ–∫–∞ 111:
```
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Character '!' is reserved and must be escaped with the preceding '\'
```

### 2. –û—à–∏–±–∫–∞ –≤ `lessons.py` —Å—Ç—Ä–æ–∫–∞ 88:
```
TelegramBadRequest: Telegram server says - Bad Request: can't parse entities: Character '.' is reserved and must be escaped with the preceding '\'
```

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –¥–≤–æ–π–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `start.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** `escape_markdown` –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –∫ —Ç–µ–∫—Å—Ç—É, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (`\\!`, `\\-`, `\\\\.`)

**–ë—ã–ª–æ:**
```python
welcome_text = escape_markdown(f"""üëã *–ü—Ä–∏–≤–µ—Ç\\! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ IQStocker* üìä
...
üéâ *–°—é—Ä–ø—Ä–∏–∑\\!* –£ —Ç–µ–±—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ—Å—Ç PRO\\-–ø–ª–∞–Ω–∞ –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏\\!
...
*–¢–≤–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ:* TEST_PRO \\(–¥–æ {test_pro_expires_str}\\)
...
–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã\\! üëá""")
```

**–°—Ç–∞–ª–æ:**
```python
welcome_text = escape_markdown(f"""üëã *–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ IQStocker* üìä
...
üéâ *–°—é—Ä–ø—Ä–∏–∑!* –£ —Ç–µ–±—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ—Å—Ç PRO-–ø–ª–∞–Ω–∞ –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏!
...
*–¢–≤–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ:* TEST_PRO (–¥–æ {test_pro_expires_str})
...
–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã! üëá""")
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö –≤ `lessons.py`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `lesson.title` –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö

**–ë—ã–ª–æ:**
```python
for lesson in lessons:
    lessons_text += f"\n‚Ä¢ {lesson.title} [—Å—Å—ã–ª–∫–∞ ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω]"
```

**–°—Ç–∞–ª–æ:**
```python
for lesson in lessons:
    lessons_text += f"\n‚Ä¢ {escape_markdown(lesson.title)} [—Å—Å—ã–ª–∫–∞ ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω]"
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ `+` –≤ `bot/utils/markdown.py`
**–§–∞–π–ª:** `bot/utils/markdown.py`
```python
def escape_markdown(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown."""
    return (text.replace('*', '\\*')
                .replace('-', '\\-')
                .replace('(', '\\(')
                .replace(')', '\\)')
                .replace('.', '\\.')
                .replace('!', '\\!')
                .replace('_', '\\_')
                .replace('[', '\\[')
                .replace(']', '\\]')
                .replace('`', '\\`')
                .replace('+', '\\+'))  # ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- ‚úÖ **–ò–º–ø–æ—Ä—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** OK
- ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:** OK
- ‚úÖ **F-—Å—Ç—Ä–æ–∫–∏:** OK
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ lessons:** OK
- ‚úÖ **–í—Å–µ —Å–∏–º–≤–æ–ª—ã –≤–∫–ª—é—á–∞—è +:** OK

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. `bot/handlers/start.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –¥–≤–æ–π–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. `bot/handlers/lessons.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö
3. `bot/utils/markdown.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ `+`

## üöÄ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

1. ‚úÖ **–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. ‚úÖ **–í—Å–µ —Å–∏–º–≤–æ–ª—ã —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã** –≤–∫–ª—é—á–∞—è `+`, `!`, `.`
3. ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è
4. ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –¥–≤–æ–π–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
5. ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã**

## üí° –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

1. **–ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ /start** –±–æ—Ç—É –≤ Telegram
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∫–Ω–æ–ø–∫–∏** - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ CSV —Ñ–∞–π–ª** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
5. **–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏** - –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

## üéØ –ò—Ç–æ–≥:

**–í–°–ï –û–®–ò–ë–ö–ò –ò–ó –õ–û–ì–û–í –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–´!**

- ‚úÖ **Character '!' is reserved** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ **Character '.' is reserved** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
- ‚úÖ **Character '+' is reserved** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ f-—Å—Ç—Ä–æ–∫–∞—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –¥–≤–æ–π–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã** - OK

**–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!** üéâ
