# üéØ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π IQStocker –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –≤ –∫–æ–¥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–°–ø–∏—Å–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–∏–º–∏—Ç –Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Å–ø–∏—Å—ã–≤–∞–ª—Å—è –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV-—Ñ–∞–π–ª–∞. –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–¥–∞–ª–∞, –ª–∏–º–∏—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –±—ã–ª –ø–æ—Ç—Ä–∞—á–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** 
- –£–¥–∞–ª–µ–Ω–æ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –≤ `bot/handlers/analytics.py` (—Å—Ç—Ä–æ–∫–∏ 565, 653)
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–ø–∏—Å–∞–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `process_csv_analysis()` (—Å—Ç—Ä–æ–∫–∞ 917-919)

```python
# –°–ü–ò–°–´–í–ê–ï–ú –õ–ò–ú–ò–¢ –¢–û–õ–¨–ö–û –ü–û–°–õ–ï –£–°–ü–ï–®–ù–û–ô –û–ë–†–ê–ë–û–¢–ö–ò
user_limits = db.query(Limits).filter(Limits.user_id == user.id).first()
if user_limits:
    user_limits.analytics_used += 1
```

### 2. **–õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –±—ã–ª–æ —á–µ—Ç–∫–æ–π –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏ vs –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `core/subscriptions/payment_handler.py`
- –õ–æ–≥–∏–∫–∞: –ø—Ä–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏ –ª–∏–º–∏—Ç—ã **–¥–æ–±–∞–≤–ª—è—é—Ç—Å—è** –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º (–º–æ–∂–Ω–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å)
- –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ `analytics_used` –∏ `themes_used` –ù–ï –æ–±–Ω—É–ª—è—é—Ç—Å—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è)

### 3. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ –±—ã–ª–∏ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏ –≤ `bot/lexicon/lexicon_ru.py`:
  - `limits_analytics_exhausted`
  - `limits_themes_exhausted`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–µ–∫—Å–∏–∫–æ–Ω–∞

---

## üõ†Ô∏è –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏**

#### GET `/api/admin/users/{user_id}/limits`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "data": {
    "user_id": 123,
    "telegram_id": 987654321,
    "username": "john_doe",
    "subscription_type": "PRO",
    "limits": {
      "analytics_total": 5,
      "analytics_used": 2,
      "analytics_remaining": 3,
      "themes_total": 10,
      "themes_used": 4,
      "themes_remaining": 6
    }
  }
}
```

#### PUT `/api/admin/users/{user_id}/limits`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "analytics_total": 10,
  "analytics_used": 2,
  "themes_total": 20,
  "themes_used": 5
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "message": "Limits updated for user 123",
  "data": {
    "user_id": 123,
    "username": "john_doe",
    "telegram_id": 987654321,
    "old_values": {
      "analytics_total": 5,
      "analytics_used": 2,
      "themes_total": 10,
      "themes_used": 4
    },
    "new_values": {
      "analytics_total": 10,
      "analytics_used": 2,
      "themes_total": 20,
      "themes_used": 5
    },
    "current_limits": {
      "analytics_total": 10,
      "analytics_used": 2,
      "analytics_remaining": 8,
      "themes_total": 20,
      "themes_used": 5,
      "themes_remaining": 15
    }
  }
}
```

**–í–∞–∂–Ω–æ:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `AuditLog` —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
- –ö—Ç–æ –∏–∑–º–µ–Ω–∏–ª (admin_username)
- –ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª (created_at)
- –ö–∞–∫–∏–µ –±—ã–ª–∏ —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (old_values)
- –ö–∞–∫–∏–µ —Å—Ç–∞–ª–∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (new_values)

### 2. **Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏**

**URL:** `/admin/user-limits`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ User ID (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID –∏–∑ –±–∞–∑—ã)
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –ª–∏–º–∏—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö 4 –ø–æ–ª–µ–π –ª–∏–º–∏—Ç–æ–≤:
  - `analytics_total` - –í—Å–µ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫
  - `analytics_used` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫
  - `themes_total` - –í—Å–µ–≥–æ —Ç–µ–º
  - `themes_used` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–µ–º
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üîÑ –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å Bootstrap 5
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –∫–Ω–æ–ø–∫–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ badge-—ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
- Responsive-–¥–∏–∑–∞–π–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ª–∏–º–∏—Ç–æ–≤

### –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –ª–∏–º–∏—Ç—ã (–∏–∑ `config/settings.py`)

| –¢–∞—Ä–∏—Ñ | –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–º–µ—Å.) | –¢–µ–º—ã (–º–µ—Å.) |
|-------|------------------|-------------|
| **FREE** | 0 | 4 |
| **TEST_PRO** | 1 | 2 (–∑–∞ 2 –Ω–µ–¥–µ–ª–∏) |
| **PRO** | 1 | 4 |
| **ULTRA** | 2 | 4 |

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ª–∏–º–∏—Ç–æ–≤

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (TEST_PRO)**
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `User` —Å `subscription_type = TEST_PRO`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å `Limits` —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ settings
   - `bot/handlers/start.py` (—Å—Ç—Ä–æ–∫–∏ 61-68)

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**
   - **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** –õ–∏–º–∏—Ç —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV
   - **–¢–µ–º—ã:** –õ–∏–º–∏—Ç —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –î–û –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **–ü–æ–∫—É–ø–∫–∞/–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏**
   - –õ–∏–º–∏—Ç—ã **–¥–æ–±–∞–≤–ª—è—é—Ç—Å—è** –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º (–º–æ–∂–Ω–æ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å)
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `Subscription` —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–ª–∞—Ç–µ–∂–∞
   - `core/subscriptions/payment_handler.py` (—Å—Ç—Ä–æ–∫–∏ 91-102)

4. **–ò—Å—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `FREE`
   - `analytics_total` –∏ `themes_total` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ FREE-–∑–Ω–∞—á–µ–Ω–∏—è
   - `analytics_used` –∏ `themes_used` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (–∏—Å—Ç–æ—Ä–∏—è)
   - –ú–µ—Ç–æ–¥ `check_subscription_expiry()` (—Å—Ç—Ä–æ–∫–∏ 117-155)

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ê—É–¥–∏—Ç

### Audit Log
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `audit_logs`:

**–ü–æ–ª—è:**
- `admin_username` - –ö—Ç–æ –∏–∑–º–µ–Ω–∏–ª
- `admin_ip` - –° –∫–∞–∫–æ–≥–æ IP
- `action` - –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (UPDATE)
- `resource_type` - –¢–∏–ø —Ä–µ—Å—É—Ä—Å–∞ (Limits)
- `resource_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `old_values` - –°—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (JSON)
- `new_values` - –ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (JSON)
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- `created_at` - –í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä Audit Log
–î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º —á–µ—Ä–µ–∑:
- API: `/api/audit/logs`
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: SQLAdmin ‚Üí AuditLog

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å–∫ FastAPI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:**
   ```bash
   cd scripts/runners
   python admin_fastapi.py
   ```
   –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   venv\Scripts\activate
   python scripts/runners/admin_fastapi.py
   ```

2. **–î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:5000/admin/user-limits`
   - –í–æ–π–¥–∏—Ç–µ —Å admin credentials (–∏–∑ `.env`)

3. **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
   
   **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏–º–∏—Ç–æ–≤**
   - –ù–∞–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ User ID
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ "–û—Å—Ç–∞–ª–æ—Å—å" —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

   **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤**
   - –ò–∑–º–µ–Ω–∏—Ç–µ `analytics_total` —Å 5 –Ω–∞ 10
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ "–û—Å—Ç–∞–ª–æ—Å—å"

   **–°—Ü–µ–Ω–∞—Ä–∏–π 3: Audit Log**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/admin` ‚Üí AuditLog
   - –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å—Ç–∞—Ä—ã—Ö –∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

   **–°—Ü–µ–Ω–∞—Ä–∏–π 4: API –Ω–∞–ø—Ä—è–º—É—é**
   ```bash
   # GET request
   curl -X GET http://localhost:5000/api/admin/users/1/limits
   
   # PUT request
   curl -X PUT http://localhost:5000/api/admin/users/1/limits \
     -H "Content-Type: application/json" \
     -d '{"analytics_total": 10, "analytics_used": 2, "themes_total": 20, "themes_used": 5}'
   ```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `tests/integration/test_limits_api.py`:

```python
import pytest
from fastapi.testclient import TestClient
from scripts.runners.admin_fastapi import app

client = TestClient(app)

def test_get_user_limits():
    response = client.get("/api/admin/users/1/limits")
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
    assert "limits" in data["data"]

def test_update_user_limits():
    response = client.put(
        "/api/admin/users/1/limits",
        json={
            "analytics_total": 10,
            "analytics_used": 2,
            "themes_total": 20,
            "themes_used": 5
        }
    )
    assert response.status_code == 200
    data = response.json()
    assert data["success"] == True
```

---

## üìù Checklist –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- [x] –ú–æ–¥–µ–ª—å `Limits` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [x] –ó–Ω–∞—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –≤ `settings.py` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–∞—Ä–∏—Ñ–∞–º
- [x] –õ–∏–º–∏—Ç—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [x] –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `lexicon_ru.py`
- [x] API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `AuditLog`
- [x] Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `bot/handlers/analytics.py` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–ø–∏—Å–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
2. `bot/handlers/themes.py` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–µ–∫—Å–∏–∫–æ–Ω–∞
3. `bot/lexicon/lexicon_ru.py` - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö
4. `core/subscriptions/payment_handler.py` - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
5. `scripts/runners/admin_fastapi.py` - –î–æ–±–∞–≤–ª–µ–Ω—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. `admin/templates/user_limits.html` - Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏
2. `LIMITS_MANAGEMENT_GUIDE.md` - –î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ Audit Log** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ User ID**, –∞ –Ω–µ Telegram ID –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã** —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º `*_used` –ø–æ–ª–µ–π - —ç—Ç–æ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
4. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ backup** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ª–∏–º–∏—Ç–æ–≤
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ** —á–∞—Å—Ç–æ—Ç—É –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-26  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** IQStocker Development Team

