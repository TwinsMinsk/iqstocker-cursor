# Процедура тестирования модуля "Топ тем"

## ⚠️ ВАЖНОЕ ОБНОВЛЕНИЕ

**Функция глубокого анализа тем была удалена из системы.**

Топ-темы теперь берутся напрямую из CSV-файла без фоновой обработки через LLM и скрапинг Adobe Stock.

## Текущая функциональность

1. **Загрузка CSV-файла** - пользователь загружает файл с продажами
2. **Обработка данных** - система анализирует CSV и извлекает топ-10 тем по выручке
3. **Генерация отчета** - создается отчет с KPI и топ-темами
4. **Сохранение результатов** - топ-темы сохраняются в базу данных

## Что было удалено

- ❌ Скрапинг тегов с Adobe Stock через Playwright
- ❌ LLM-категоризация тем
- ❌ Фоновые задачи Dramatiq для анализа тем
- ❌ Модуль `workers/theme_actors.py`
- ❌ Модуль `core/parser/adobe_stock_playwright.py`

## Тестирование текущей функциональности

### Подготовка

1. **Активировать виртуальное окружение**
   ```bash
   # Windows
   venv\Scripts\activate
   
   # Linux/Mac
   source venv/bin/activate
   ```

2. **Иметь тестовый CSV-файл с данными продаж**
   - Файл должен содержать колонки: `Asset ID`, `Title`, `Sales`, `Revenue`
   - Пример файла: `uploads/test_final_analysis.csv`

### Тестирование через бота

1. Запустить бота: `python start_bot.py`
2. Отправить команду `/start`
3. Выбрать "Аналитика портфеля"
4. Загрузить CSV-файл
5. Ответить на вопросы о портфеле
6. Получить отчет с топ-темами

### Проверка результатов

Топ-темы будут содержать:
- Название темы (из поля `Title` CSV)
- Количество продаж
- Выручку
- Ранг (1-10)

Без дополнительной LLM-обработки или скрапинга тегов.

## Проверка результатов в БД

### Проверка TopTheme:

```sql
SELECT * FROM top_themes WHERE csv_analysis_id = <ID> ORDER BY rank;
```

**Проверить:**
- Корректные названия тем (из поля Title CSV)
- Ранжирование (rank от 1 до 10)
- Суммы продаж и доходов (положительные числа)
- Связь с правильным csv_analysis_id

## Заключение

После успешного прохождения тестирования система "Топ тем" должна:

✅ Корректно извлекать топ-ассеты из CSV  
✅ Сохранять результаты в БД  
✅ Показывать приемлемую производительность  

**Время полного тестирования:** ~5-10 минут  
**Ресурсы:** CSV-файл