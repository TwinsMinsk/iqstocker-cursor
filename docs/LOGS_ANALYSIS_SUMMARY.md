# üìä –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ Railway (13.11.2025)

## –§–∞–π–ª –ª–æ–≥–æ–≤: `logs.1763005516930.log`

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –û–¢–õ–ò–ß–ù–û

### 1. **üéâ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ**

#### Worker Service (03:39:32)
```
‚öôÔ∏è Starting Worker Service...
Dramatiq '1.18.0' is booting up.
Worker process is ready for action.
```
‚úÖ Dramatiq worker –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏

#### Bot Service (03:41:22)
```
ü§ñ Starting Bot Service...
Bot started successfully
Start polling
Run polling for bot @iqstocker_testbot id=7969578689
```
‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ polling, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram

#### Web Service (03:43:20)
```
üåê Starting Web Service (Admin Panel)...
Uvicorn running on http://0.0.0.0:8080
Admin Panel: http://0.0.0.0:8080/dashboard
```
‚úÖ Admin Panel –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080

---

### 2. **‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Supabase**

```
Using SUPABASE_SESSION_LIMIT=15 for concurrent async sessions
Configured NullPool for Supabase (transaction/session pooler)
Using SSL for async connections: True
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞:**
- ‚úÖ NullPool –¥–ª—è Supabase Session Pooler
- ‚úÖ 15 concurrent sessions (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è PRO plan)
- ‚úÖ SSL –≤–∫–ª—é—á—ë–Ω
- ‚úÖ Statement cache –æ—Ç–∫–ª—é—á—ë–Ω (–¥–ª—è pgbouncer compatibility)

---

### 3. **‚úÖ –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

```
Update id=129973777 is handled. Duration 1936 ms
Update id=129973778 is handled. Duration 885 ms
Update id=129973779 is handled. Duration 1557 ms
Update id=129973780 is handled. Duration 1368 ms
Update id=129973781 is handled. Duration 1107 ms
Update id=129973782 is handled. Duration 896 ms
```

**–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏: **~1200ms** (1.2 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—Ä–æ—Å: **885ms**
- ‚úÖ –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π: **1936ms** (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å, —Ö–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: **~900-1100ms** –ø–æ—Å–ª–µ –ø—Ä–æ–≥—Ä–µ–≤–∞

**–í—ã–≤–æ–¥:** –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è –¥–ª—è Railway Hobby plan (512MB RAM, 0.5 vCPU)

---

### 4. **‚úÖ Lexicon –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

```
Loaded 114 lexicon entries from database
Lexicon merge: DB=114 keys, Static=211 keys, Merged=222 keys (DB has priority)
```

‚úÖ –õ–µ–∫—Å–∏–∫–æ–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î –∏ –º–µ—Ä–∂–∏—Ç—Å—è —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –∫–ª—é—á–∞–º–∏

**–ó–∞–º–µ—á–∞–Ω–∏–µ:** Lexicon –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** (–≤–∏–¥–Ω–æ 5 –∑–∞–≥—Ä—É–∑–æ–∫ –≤ –ª–æ–≥–∞—Ö):
```
Cache cleared due to force_refresh=True
```

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ **–Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ**. –ü—Ä–∏—á–∏–Ω–∞ ‚Äî Redis –∫—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–º. –ø—Ä–æ–±–ª–µ–º—ã –Ω–∏–∂–µ).

---

### 5. **‚úÖ Scheduler –∑–∞–ø—É—â–µ–Ω**

```
Scheduler started
Added job "Send 1-day theme limit burn reminders" to job store "default"
Added job "Check expired TEST_PRO subscriptions" to job store "default"
Added job "Send weekly themes notifications" to job store "default"
Added job "Send monthly marketing notifications" to job store "default"
...
```

‚úÖ –í—Å–µ scheduled –∑–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

---

### 6. **‚úÖ Alembic –º–∏–≥—Ä–∞—Ü–∏–∏**

```
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
```

‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### **1. Redis Authentication –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)**

#### –°–∏–º–ø—Ç–æ–º—ã:
```
Consumer encountered a connection error: invalid username-password pair or user is disabled.
Restarting consumer in 3.00 seconds.
```

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è **–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã** –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã worker service.

#### –¢–µ–∫—É—â–∏–π Redis URL:
```
redis://default:gXfwRBnQrRhQxQHozubCVoybREKxrNDM@t...
```

–≠—Ç–æ **Railway Proxy URL**, –Ω–æ –æ–Ω **–≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**.

#### –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–ª–∏—è–Ω–∏–µ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------|---------|-------------|
| **Dramatiq Worker** | ‚ùå –ù–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ | üî¥ –í—ã—Å–æ–∫–∞—è |
| **User Cache** | ‚ùå –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥—ë—Ç –≤ Supabase (~50-100ms –≤–º–µ—Å—Ç–æ ~5ms) | üü° –°—Ä–µ–¥–Ω—è—è |
| **Lexicon Cache** | ‚ùå –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î –∫–∞–∂–¥—ã–π —Ä–∞–∑ (–≤–∏–¥–Ω–æ 5+ –∑–∞–≥—Ä—É–∑–æ–∫ –≤ –ª–æ–≥–∞—Ö) | üü° –°—Ä–µ–¥–Ω—è—è |
| **CPU Usage** | ‚ùå Worker –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã | üü° –°—Ä–µ–¥–Ω—è—è |

#### –ü–æ—á–µ–º—É CSV –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–í –ª–æ–≥–∞—Ö –º—ã –ù–ï –≤–∏–¥–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. Dramatiq worker **–Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–∞–¥–∞—á–∏** –∏–∑ Redis queue
2. **–ù–û** –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è graceful degradation

**–í–æ–ø—Ä–æ—Å:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏—Ç CSV –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –±—É–¥–µ—Ç –ª–∏ –æ–Ω –æ–±—Ä–∞–±–æ—Ç–∞–Ω?
- ‚ùå **–ù–ï–¢**, –ø–æ—Ç–æ–º—É —á—Ç–æ Dramatiq worker –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- ‚úÖ –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞", –Ω–æ –∑–∞–¥–∞—á–∞ **–∑–∞–≤–∏—Å–Ω–µ—Ç** –≤ –æ—á–µ—Ä–µ–¥–∏

#### –†–µ—à–µ–Ω–∏–µ:

**–Ø —É–∂–µ –≤–Ω—ë—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥:**

1. **`workers/actors.py`**: –î–æ–±–∞–≤–∏–ª —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Railway Redis Proxy:
   - `socket_connect_timeout=10`
   - `socket_keepalive=True`
   - `retry_on_timeout=True`
   - `health_check_interval=30`

2. **`config/database.py`**: –î–æ–±–∞–≤–∏–ª —Ç–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Redis client –≤ –±–æ—Ç–µ

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **Commit –∏ push –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git add workers/actors.py config/database.py core/cache/user_cache.py docs/
   git commit -m "fix: Add Railway-compatible Redis connection settings"
   git push origin <—Ç–≤–æ—è_–≤–µ—Ç–∫–∞>
   ```

2. **Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã**

3. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã:**
   - –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: `Redis connected successfully with Railway-compatible settings`
   - –î–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å: `invalid username-password pair or user is disabled`

4. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è**, –∏—Å–ø–æ–ª—å–∑—É–π **Upstash Redis** (—Å–º. `docs/REDIS_FIX_GUIDE.md`)

---

## üü° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### **1. Lexicon –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis)**

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```
Cache cleared due to force_refresh=True
Loaded 114 lexicon entries from database
```

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **5 —Ä–∞–∑** –≤ –ª–æ–≥–∞—Ö –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥.

**–ü—Ä–∏—á–∏–Ω–∞:** Redis –∫—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç lexicon –∏–∑ Supabase.

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis:**
- Lexicon –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **1 —Ä–∞–∑** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —á–∏—Ç–∞—é—Ç –∏–∑ Redis –∫—ç—à–∞ (~5ms –≤–º–µ—Å—Ç–æ ~200ms)

---

### **2. –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤**

**–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- –°—Ä–µ–¥–Ω—è—è: **~1200ms**
- –î–∏–∞–ø–∞–∑–æ–Ω: **885ms - 1936ms**

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis:**
- –û–∂–∏–¥–∞–µ–º–∞—è —Å—Ä–µ–¥–Ω—è—è: **~600-800ms** (—ç–∫–æ–Ω–æ–º–∏—è ~400-600ms –Ω–∞ –∫—ç—à–µ)
- –î–∏–∞–ø–∞–∑–æ–Ω: **400ms - 1000ms**

**–ü–æ—á–µ–º—É —É–ª—É—á—à–∏—Ç—Å—è:**
- ‚úÖ User cache: **-50ms** (—á—Ç–µ–Ω–∏–µ –∏–∑ Redis –≤–º–µ—Å—Ç–æ Supabase)
- ‚úÖ Limits cache: **-50ms**
- ‚úÖ Lexicon cache: **-200ms** (–Ω–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ –ë–î –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Supabase connections

---

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RAM (–ø—Ä–æ–≤–µ—Ä—å Railway Metrics)**

–í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫ OOM (Out of Memory), –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. Railway Dashboard ‚Üí —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí Metrics
2. –°–º–æ—Ç—Ä–∏ **RAM usage** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
   - **Bot service**: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **< 300MB**
   - **Worker service**: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **< 200MB**
   - **Web service**: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **< 150MB**

**–ï—Å–ª–∏ RAM > 400MB** –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–∏—Å–µ:
- ‚ö†Ô∏è –†–∏—Å–∫ OOM Kill –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å plan

---

### **4. Supabase Connections (–ø—Ä–æ–≤–µ—Ä—å Dashboard)**

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `SUPABASE_SESSION_LIMIT=15` concurrent sessions
- NullPool (–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å = –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

**–ü—Ä–æ–≤–µ—Ä—å –≤ Supabase Dashboard:**
1. Settings ‚Üí Database ‚Üí Connection Pooling
2. –°–º–æ—Ç—Ä–∏ **Active Connections**

**–î–ª—è PRO plan:**
- –õ–∏–º–∏—Ç: **500 connections** (Session Pooler)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: **< 100 connections**

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å > 100 active connections:**
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ, connections –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å–µ `async with session:` –±–ª–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

---

## üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ü–û–î –ù–ê–ì–†–£–ó–ö–û–ô

### –¢–µ–∫—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–∑ –ª–æ–≥–æ–≤):
- **6 –∑–∞–ø—Ä–æ—Å–æ–≤** –∑–∞ **~15 —Å–µ–∫—É–Ω–¥**
- **~0.4 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫—É–Ω–¥—É**

### –ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è 1000-2000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (10% –æ–Ω–ª–∞–π–Ω)
- **100-200 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **~10-20 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É**
- **~0.3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫—É–Ω–¥—É**

‚úÖ **Railway Hobby plan —Å–ø—Ä–∞–≤–∏—Ç—Å—è** (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º Redis)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (30% –æ–Ω–ª–∞–π–Ω)
- **300-600 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **~30-60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É**
- **~1 –∑–∞–ø—Ä–æ—Å/—Å–µ–∫—É–Ω–¥—É**

üü° **Railway Hobby plan –Ω–∞ –≥—Ä–∞–Ω–∏** (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è upgrade)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (50% –æ–Ω–ª–∞–π–Ω, –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—è)
- **500-1000 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **~50-100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É**
- **~2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫—É–Ω–¥—É**

üî¥ **Railway Hobby plan –ù–ï —Å–ø—Ä–∞–≤–∏—Ç—Å—è** (–Ω—É–∂–µ–Ω Pro plan: $20/month, 8GB RAM, 8 vCPU)

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô (–ü–†–ò–û–†–ò–¢–ï–¢–´)

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   - ‚úÖ –ö–æ–¥ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (–¥–æ–±–∞–≤–ª–µ–Ω—ã Railway-compatible –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
   - ‚è≥ Commit + push ‚Üí Railway –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã
   - ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å CSV –æ–±—Ä–∞–±–æ—Ç–∫—É:**
   - –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis –∑–∞–≥—Ä—É–∑–∏ —Ç–µ—Å—Ç–æ–≤—ã–π CSV
   - –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ—Ç—á—ë—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ worker service –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

### üü° –í–∞–∂–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏):

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ RAM:**
   - –ü—Ä–æ–≤–µ—Ä—å Railway Metrics ‚Üí RAM usage
   - –ï—Å–ª–∏ > 400MB –Ω–∞ –ª—é–±–æ–º —Å–µ—Ä–≤–∏—Å–µ ‚Üí –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –∏–ª–∏ upgrade

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Supabase Connections:**
   - –ü—Ä–æ–≤–µ—Ä—å Supabase Dashboard ‚Üí Active Connections
   - –ï—Å–ª–∏ > 100 connections ‚Üí –ø—Ä–æ–≤–µ—Ä—å —É—Ç–µ—á–∫–∏

5. **Load Testing:**
   - –ò—Å–ø–æ–ª—å–∑—É–π `tests/load_test.py` –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ 50-100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü—Ä–æ–≤–µ—Ä—å, –∫–∞–∫ –±–æ—Ç —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π

---

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–∑–∂–µ):

6. **Upstash Redis (–µ—Å–ª–∏ Railway Redis –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å):**
   - –°–º. `docs/REDIS_FIX_GUIDE.md` ‚Üí "–†–µ—à–µ–Ω–∏–µ 2: Upstash"
   - –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier: 10,000 –∫–æ–º–∞–Ω–¥/–¥–µ–Ω—å
   - –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π, —á–µ–º Railway Redis

7. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Lexicon:**
   - –°–µ–π—á–∞—Å: 114 entries –∏–∑ –ë–î + 211 static = 222 merged
   - –ú–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å merged lexicon –Ω–∞ 1 —á–∞—Å (–≤–º–µ—Å—Ç–æ force_refresh –∫–∞–∂–¥—ã–π —Ä–∞–∑)

8. **Dramatiq retry delay:**
   - –°–µ–π—á–∞—Å: –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
   - –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 10 —Å–µ–∫—É–Ω–¥ (–º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU)

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| **Bot Service** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã |
| **Worker Service** | üî¥ –ü—Ä–æ–±–ª–µ–º–∞ | Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí Dramatiq –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Web Service** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | Admin Panel –¥–æ—Å—Ç—É–ø–µ–Ω |
| **Supabase DB** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ |
| **Redis Cache** | üî¥ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | üü° –•–æ—Ä–æ—à–æ | ~1200ms/–∑–∞–ø—Ä–æ—Å, —É–ª—É—á—à–∏—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis |
| **RAM Usage** | ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ | –ù–µ—Ç OOM –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –Ω–∞–≥—Ä—É–∑–∫–µ** | üü° –ß–∞—Å—Ç–∏—á–Ω–æ | –°–ø—Ä–∞–≤–∏—Ç—Å—è —Å 100-200 –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |

---

## üéâ –ì–õ–ê–í–ù–´–ô –í–´–í–û–î

### ‚úÖ –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:
1. **–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –Ω–∏–º
2. **UX –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** (–æ—Ç—á—ë—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. **Supabase –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ**
4. **Graceful degradation —Ä–∞–±–æ—Ç–∞–µ—Ç** (–±–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å Redis)

### üî¥ –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. **Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ Dramatiq
2. –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis **–≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%**

### üìà –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis:
- ‚úÖ Dramatiq worker –Ω–∞—á–Ω—ë—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å CSV –∑–∞–¥–∞—á–∏
- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —É–ª—É—á—à–∏—Ç—Å—è –Ω–∞ **~40%** (600-800ms –≤–º–µ—Å—Ç–æ 1200ms)
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Supabase
- ‚úÖ Lexicon –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è (–Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑)

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 13.11.2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: Redis —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ

