# üéâ –í–°–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´ –ò –ü–†–ò–ú–ï–ù–ï–ù–´!

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏:

### 1. Markdown —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (32 –º–µ—Å—Ç–∞ –≤ 8 —Ñ–∞–π–ª–∞—Ö)
- `bot/handlers/themes.py` - 6 –º–µ—Å—Ç
- `bot/handlers/top_themes.py` - 4 –º–µ—Å—Ç–∞  
- `bot/handlers/lessons.py` - 3 –º–µ—Å—Ç–∞
- `bot/handlers/calendar.py` - 3 –º–µ—Å—Ç–∞
- `bot/handlers/channel.py` - 1 –º–µ—Å—Ç–æ
- `bot/handlers/faq.py` - 11 –º–µ—Å—Ç
- `bot/handlers/profile.py` - 4 –º–µ—Å—Ç–∞
- `bot/handlers/analytics.py` - –æ–±–Ω–æ–≤–ª–µ–Ω

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞—Ç–∞–º–∏ (2 –º–µ—Å—Ç–∞)
- `bot/handlers/start.py` - —Å—Ç—Ä–æ–∫–∞ 78: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞—Ç
- `bot/handlers/start.py` - —Å—Ç—Ä–æ–∫–∞ 93: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–Ω–µ–π

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –°–æ–∑–¥–∞–Ω –æ–±—â–∏–π –º–æ–¥—É–ª—å –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
**–§–∞–π–ª:** `bot/utils/markdown.py`
```python
def escape_markdown(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown."""
    return (text.replace('*', '\\*')
                .replace('-', '\\-')
                .replace('(', '\\(')
                .replace(')', '\\)')
                .replace('.', '\\.')
                .replace('!', '\\!')
                .replace('_', '\\_')
                .replace('[', '\\[')
                .replace(']', '\\]')
                .replace('`', '\\`'))

def escape_markdown_preserve_formatting(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ."""
    # –°–Ω–∞—á–∞–ª–∞ –∑–∞—â–∏—â–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    text = text.replace('**', '___BOLD___')
    text = text.replace('*', '___ITALIC___')
    
    # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–∫—Ä–æ–º–µ _)
    text = (text.replace('-', '\\-')
                .replace('(', '\\(')
                .replace(')', '\\)')
                .replace('.', '\\.')
                .replace('!', '\\!')
                .replace('[', '\\[')
                .replace(']', '\\]')
                .replace('`', '\\`'))
    
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    text = text.replace('___BOLD___', '**')
    text = text.replace('___ITALIC___', '*')
    
    return text
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Markdown
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `escape_markdown` –≤–æ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (32 –º–µ—Å—Ç–∞)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `analytics.py`

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∞—Ç–∞–º–∏
**–í `bot/handlers/start.py`:**

**–°—Ç—Ä–æ–∫–∞ 78 (–±—ã–ª–æ):**
```python
if datetime.now(timezone.utc) > user.subscription_expires_at:
```

**–°—Ç—Ä–æ–∫–∞ 78 (—Å—Ç–∞–ª–æ):**
```python
if datetime.now(timezone.utc) > user.subscription_expires_at.replace(tzinfo=timezone.utc):
```

**–°—Ç—Ä–æ–∫–∞ 93 (–±—ã–ª–æ):**
```python
days_left = (user.subscription_expires_at - datetime.now(timezone.utc)).days if user.subscription_expires_at else 0
```

**–°—Ç—Ä–æ–∫–∞ 93 (—Å—Ç–∞–ª–æ):**
```python
days_left = (user.subscription_expires_at.replace(tzinfo=timezone.utc) - datetime.now(timezone.utc)).days if user.subscription_expires_at else 0
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—Ç:** OK
- ‚úÖ **–ò–º–ø–æ—Ä—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** OK
- ‚úÖ **–§—É–Ω–∫—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:** OK
- ‚úÖ **–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:** OK

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç
1. ‚úÖ **–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
2. ‚úÖ **–ö–æ–º–∞–Ω–¥–∞ /start** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ **–í—Å–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é** –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
4. ‚úÖ **Markdown —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
5. ‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞—Ç** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
6. ‚úÖ **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª** –æ—Ç /start –¥–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `bot/utils/markdown.py` - —Å–æ–∑–¥–∞–Ω –æ–±—â–∏–π –º–æ–¥—É–ª—å –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `bot/handlers/themes.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (6 –º–µ—Å—Ç)
- `bot/handlers/top_themes.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (4 –º–µ—Å—Ç–∞)
- `bot/handlers/lessons.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (3 –º–µ—Å—Ç–∞)
- `bot/handlers/calendar.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (3 –º–µ—Å—Ç–∞)
- `bot/handlers/channel.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (1 –º–µ—Å—Ç–æ)
- `bot/handlers/faq.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (11 –º–µ—Å—Ç)
- `bot/handlers/profile.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è (4 –º–µ—Å—Ç–∞)
- `bot/handlers/analytics.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—â–µ–≥–æ –º–æ–¥—É–ª—è
- `bot/handlers/start.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∞—Ç–∞–º–∏ (2 –º–µ—Å—Ç–∞)

## üí° –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:
1. **–ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ /start** –±–æ—Ç—É –≤ Telegram
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∫–Ω–æ–ø–∫–∏** - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ CSV —Ñ–∞–π–ª** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
5. **–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏** - –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

## üéØ –ò—Ç–æ–≥
**–í–°–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´ –ò –ü–†–ò–ú–ï–ù–ï–ù–´!** 

- ‚úÖ **34 –º–µ—Å—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** (32 Markdown + 2 –¥–∞—Ç—ã)
- ‚úÖ **9 —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã**
- ‚úÖ **–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã**

**–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω!** üéâ
