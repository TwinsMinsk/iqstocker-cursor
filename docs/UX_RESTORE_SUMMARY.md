# üìù –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ UX –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –¥–ª—è high-load –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±—ã–ª **–ò–ó–ú–ï–ù–ï–ù** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å (UX) –≤ —Ä–∞–∑–¥–µ–ª–µ "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è". –≠—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ **–ø–æ –æ—à–∏–±–∫–µ**, –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è.

---

## üî¥ –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–∏—Å—Ö–æ–¥–Ω–∞—è –≤–µ—Ä—Å–∏—è)

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞):
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV
2. ‚úÖ –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä–∞–∑–º–µ—Ä –ø–æ—Ä—Ç—Ñ–µ–ª—è, –ª–∏–º–∏—Ç—ã, acceptance rate, —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
4. ‚úÖ –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–§–∞–π–ª –ø—Ä–∏–Ω—è—Ç, –ø–æ–¥–æ–∂–¥–∏..."
5. ‚úÖ **CSV –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ò –°–†–ê–ó–£ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
6. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—Ç—á–µ—Ç **–ë–ï–ó** –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –¥—Ä—É–≥–∏–µ —Ä–∞–∑–¥–µ–ª—ã

### –ß—Ç–æ —Å—Ç–∞–ª–æ –ü–û–°–õ–ï —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV
2. ‚úÖ –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç
4. ‚ùå –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ú—ã —É–≤–µ–¥–æ–º–∏–º —Ç–µ–±—è..."
5. ‚ùå –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ —Ñ–æ–Ω–µ
6. ‚ùå **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–µ—Ä–µ–π–¥–∏ –≤ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞"**
7. ‚ùå **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –í–†–£–ß–ù–£–Æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Üí –ú–æ–∏ –æ—Ç—á–µ—Ç—ã ‚Üí –≤—ã–±—Ä–∞—Ç—å –æ—Ç—á–µ—Ç**

### –ü—Ä–æ–±–ª–µ–º—ã:
- –ò–∑–º–µ–Ω–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è
- –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã —Ç–µ–∫—Å—Ç—ã (–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ "–≤—Å–µ —Ç–µ–∫—Å—Ç—ã –≤ LEXICON_RU")
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –ª–∏—à–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –º–µ–Ω—é)

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏ –≤ `bot/lexicon/lexicon_ru.py`

```python
# --- –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV ---
'csv_processing_started': "‚è≥ <b>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!</b>\n\n"
                          "–ú—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–≤–æ–π —Ñ–∞–π–ª –∏ —Å–∫–æ—Ä–æ –ø—Ä–∏—à–ª—ë–º –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç (–æ–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã).\n\n"
                          "–ú–æ–∂–µ—à—å –Ω–µ –∂–¥–∞—Ç—å - –æ—Ç—á–µ—Ç –ø—Ä–∏–¥—ë—Ç —Å—é–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
'analysis_completed_intro': "‚úÖ <b>–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!</b>\n\n"
                           "–¢–≤–æ–π –æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤. –°–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ üëá",
'analysis_failed': "‚ùå <b>–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞</b>\n\n"
                  "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
                  "‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CSV\n"
                  "‚Ä¢ –§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω\n"
                  "‚Ä¢ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n\n"
                  "–ü–æ–ø—Ä–æ–±—É–π –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.",
```

### 2. –ó–∞–º–µ–Ω–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ `bot/handlers/analytics.py`

**–ë—ã–ª–æ:**
```python
await callback.message.answer(
    "üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ú—ã —É–≤–µ–¥–æ–º–∏–º —Ç–µ–±—è, –∫–æ–≥–¥–∞ –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤.\n\n"
    "–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã."
)
```

**–°—Ç–∞–ª–æ:**
```python
await callback.message.answer(LEXICON_RU['csv_processing_started'])
```

**–ò–∑–º–µ–Ω–µ–Ω–æ –≤ 2 –º–µ—Å—Ç–∞—Ö:**
- `handle_content_type_callback` (—Å—Ç—Ä–æ–∫–∞ 701)
- `handle_content_type_text` (—Å—Ç—Ä–æ–∫–∞ 794)

### 3. –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `notify_analysis_complete` –≤ `workers/actors.py`

**–ë—ã–ª–æ:** –û—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–µ—Ä–µ–π–¥–∏ –≤ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞"

**–°—Ç–∞–ª–æ:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:

```python
@dramatiq.actor
def notify_analysis_complete(user_telegram_id: int, csv_analysis_id: int):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞."""
    from aiogram import Bot
    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
    from config.settings import settings
    from bot.lexicon import LEXICON_RU, LEXICON_COMMANDS_RU
    from config.database import SessionLocal
    from database.models import AnalyticsReport
    import asyncio
    
    try:
        bot = Bot(token=settings.bot_token)
        db = SessionLocal()
        
        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –∏–∑ –ë–î
        report = db.query(AnalyticsReport).filter(
            AnalyticsReport.csv_analysis_id == csv_analysis_id
        ).first()
        
        if not report:
            logger.error(f"Report not found for analysis {csv_analysis_id}")
            db.close()
            return
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
        async def send_report():
            try:
                # 1. –í–≤–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                await bot.send_message(
                    chat_id=user_telegram_id,
                    text=LEXICON_RU['analysis_completed_intro']
                )
                
                # 2. –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
                back_to_menu_keyboard = InlineKeyboardMarkup(inline_keyboard=[
                    [InlineKeyboardButton(
                        text=LEXICON_COMMANDS_RU['back_to_main_menu'],
                        callback_data=f"analytics_report_back_{csv_analysis_id}"
                    )]
                ])
                
                await bot.send_message(
                    chat_id=user_telegram_id,
                    text=report.report_text_html,
                    reply_markup=back_to_menu_keyboard,
                    parse_mode="HTML"
                )
                
            finally:
                await bot.session.close()
        
        asyncio.run(send_report())
        db.close()
        
        logger.info(f"Full report sent to user {user_telegram_id}")
        
    except Exception as e:
        logger.error(f"Failed to send report to user {user_telegram_id}: {e}", exc_info=True)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç –∏–∑ –ë–î (`AnalyticsReport.report_text_html`)
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–≤–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!"
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç **–ø–æ–ª–Ω—ã–π HTML –æ—Ç—á–µ—Ç** —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
4. –î–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `notify_analysis_failed` –≤ `workers/actors.py`

**–ë—ã–ª–æ:**
```python
text=LEXICON_RU.get('analysis_failed', '‚ùå –û—à–∏–±–∫–∞...')  # –° fallback
```

**–°—Ç–∞–ª–æ:**
```python
text=LEXICON_RU['analysis_failed']  # –ë–µ–∑ fallback, –∫–ª—é—á –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
```

---

## üéØ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ü–†–ê–í–ò–õ–¨–ù–´–ô)

### –¢–µ–ø–µ—Ä—å UX —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV
2. ‚úÖ –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (FSM states)
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
4. ‚úÖ –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞! –ú—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–≤–æ–π —Ñ–∞–π–ª –∏ —Å–∫–æ—Ä–æ –ø—Ä–∏—à–ª—ë–º –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç"
5. ‚úÖ **CSV –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ (Dramatiq worker)**
6. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤–≤–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!"**
7. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ü–û–õ–ù–´–ô –æ—Ç—á–µ—Ç —Å—Ä–∞–∑—É –∂–µ (report_text_html)**
8. ‚úÖ –û—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
   - üìä –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ø—Ä–æ–¥–∞–∂–∏, –¥–æ—Ö–æ–¥, –ø—Ä–æ—Ü–µ–Ω—Ç—ã)
   - üìù –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è
   - üí° –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   - üîò –ö–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
9. ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω –Ω–∏–∫—É–¥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å ‚Äî –≤—Å—ë –ø—Ä–∏—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

---

## üîÑ –û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏):
- **–ë—ã–ª–æ:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV (–±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞)
- **–°—Ç–∞–ª–æ:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Dramatiq worker (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞)

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (UX):
- ‚úÖ –¶–µ–ø–æ—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ FSM states
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–æ–≤
- ‚úÖ –í—Å–µ —Ç–µ–∫—Å—Ç—ã –∏–∑ LEXICON_RU
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç—á–µ—Ç –°–†–ê–ó–£ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ –º–µ–Ω—é)**

### –£–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –ë–æ—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV (—ç–∫–æ–Ω–æ–º–∏—è RAM)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç OOM Kill –Ω–∞ Railway Hobby (512MB)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–µ –∂–¥–∞—Ç—å ‚Äî –æ—Ç—á–µ—Ç –ø—Ä–∏–¥—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ high-load —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (Pandas chunks, AsyncSession, rate limiting, etc.)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

| –ê—Å–ø–µ–∫—Ç | –û—Ä–∏–≥–∏–Ω–∞–ª (–¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞) | –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û) | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ü–†–ê–í–ò–õ–¨–ù–û) |
|--------|---------------------------|----------------------------------|------------------------------|
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ CSV** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞) | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (Dramatiq) | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (Dramatiq) ‚úÖ |
| **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞** | –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –¢–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚ùå | –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç —Å—Ä–∞–∑—É ‚úÖ |
| **–ù—É–∂–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –≤ –º–µ–Ω—é?** | –ù–µ—Ç | –î–∞ ‚ùå | –ù–µ—Ç ‚úÖ |
| **–¢–µ–∫—Å—Ç—ã –≤ LEXICON_RU** | –î–∞ | –ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã ‚ùå | –í—Å–µ –≤ –ª–µ–∫—Å–∏–∫–æ–Ω–µ ‚úÖ |
| **RAM usage** | –í—ã—Å–æ–∫–∏–π (—Ä–∏—Å–∫ OOM) | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚úÖ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚úÖ |
| **UX –∏–∑–º–µ–Ω–µ–Ω?** | - | –î–∞ ‚ùå | –ù–µ—Ç ‚úÖ |

---

## ‚úÖ –ß—Ç–æ –ù–ï –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (backend –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è high-load –æ—Å—Ç–∞–ª–∏—Å—å:

1. ‚úÖ **Pandas chunks** ‚Äî —á—Ç–µ–Ω–∏–µ CSV –ø–æ—Ä—Ü–∏—è–º–∏ (—ç–∫–æ–Ω–æ–º–∏—è RAM)
2. ‚úÖ **AsyncSession** ‚Äî –≤—Å–µ DB queries –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
3. ‚úÖ **Dramatiq workers** ‚Äî —Ç—è–∂–µ–ª–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ
4. ‚úÖ **Supabase Storage** ‚Äî —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞ —ç—Ñ–µ–º–µ—Ä–Ω–æ–º –¥–∏—Å–∫–µ
5. ‚úÖ **Rate Limiting** ‚Äî 10 —Ñ–∞–π–ª–æ–≤/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. ‚úÖ **Resource Monitor** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ RAM/CPU –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
7. ‚úÖ **Graceful Shutdown** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á
8. ‚úÖ **ManagedSessionLocal** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö DB —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### 1. `bot/lexicon/lexicon_ru.py`
- **–î–æ–±–∞–≤–ª–µ–Ω–æ**: 3 –Ω–æ–≤—ã—Ö –∫–ª—é—á–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV
- **–°—Ç—Ä–æ–∫–∏**: 111-122

### 2. `bot/handlers/analytics.py`
- **–ò–∑–º–µ–Ω–µ–Ω–æ**: –ó–∞–º–µ–Ω–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ –∫–ª—é—á–∏ –∏–∑ –ª–µ–∫—Å–∏–∫–æ–Ω–∞
- **–°—Ç—Ä–æ–∫–∏**: 701, 794

### 3. `workers/actors.py`
- **–ü–µ—Ä–µ–ø–∏—Å–∞–Ω**: `notify_analysis_complete` ‚Äî —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω**: `notify_analysis_failed` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á –∏–∑ –ª–µ–∫—Å–∏–∫–æ–Ω–∞
- **–°—Ç—Ä–æ–∫–∏**: 261-319, 333-340

### 4. `docs/SUPABASE_POLICY_FIX.md` (–Ω–æ–≤—ã–π)
- **–°–æ–∑–¥–∞–Ω**: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é Supabase Storage policy

### 5. `docs/UX_RESTORE_SUMMARY.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- **–°–æ–∑–¥–∞–Ω**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π UX

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ UX –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç—á–µ—Ç **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏**
- **–ù–∏–∫–∞–∫–∏—Ö** –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ –º–µ–Ω—é
- –í—Å–µ —Ç–µ–∫—Å—Ç—ã –≤ `LEXICON_RU` (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞)

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Dramatiq
- –≠–∫–æ–Ω–æ–º–∏—è RAM (chunks, AsyncSession)
- Supabase Storage (ephemeral filesystem protection)
- Rate limiting & monitoring

### ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º:
- –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ 1000-2000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- Railway Hobby (512MB RAM) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- Supabase PRO (200 connections) —Å –∑–∞–ø–∞—Å–æ–º

---

## üìû –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤—å Supabase Policy** ‚Äî —Å–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `docs/SUPABASE_POLICY_FIX.md`
2. ‚úÖ **–ó–∞–¥–µ–ø–ª–æ–π –≤ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ** ‚Äî —Å–ª–µ–¥—É–π `docs/TESTING_GUIDE.md`
3. ‚úÖ **Smoke Test** ‚Äî –∑–∞–≥—Ä—É–∑–∏ 1 CSV –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ—Ç—á–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. ‚úÖ **Load Test** ‚Äî –∑–∞–ø—É—Å—Ç–∏ `poetry run python tests/load_test.py`
5. ‚úÖ **–ü–µ—Ä–µ–Ω–µ—Å–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω** ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

---

**–î–∞—Ç–∞**: 2024-11-13  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã  
**UX**: ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
**Backend**: ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è high-load —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

