# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ Telegram

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞:
```
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: wrong file_id or the file is temporarily unavailable
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `bot.download()` –≤ aiogram 3.x.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ß—Ç–æ –±—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```python
file_info = await message.bot.get_file(document.file_id)
file_data = await message.bot.download(file_info.file_path)  # ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
```

### –ß—Ç–æ —Å—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```python
file_info = await message.bot.get_file(document.file_id)
file_data = await message.bot.download(file_info)  # ‚úÖ –ü–µ—Ä–µ–¥–∞—ë–º File –æ–±—ä–µ–∫—Ç
```

---

## üìñ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ

–í **aiogram 3.x** –º–µ—Ç–æ–¥ `bot.download()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:
- ‚úÖ `File` –æ–±—ä–µ–∫—Ç (—Ä–µ–∑—É–ª—å—Ç–∞—Ç `bot.get_file()`)
- ‚úÖ `file_id` —Å—Ç—Ä–æ–∫—É
- ‚ùå –ù–ï `file_path` —Å—Ç—Ä–æ–∫—É

**–ü–æ—á–µ–º—É –æ—à–∏–±–∫–∞:**
- `file_info.file_path` ‚Äî —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Telegram
- Telegram API –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ –ø—É—Ç—å –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤–µ—Å—å `File` –æ–±—ä–µ–∫—Ç –∏–ª–∏ `file_id`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –ü–µ—Ä–µ–π–¥–∏ –≤ "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è"
3. –ó–∞–≥—Ä—É–∑–∏ —Ç–µ—Å—Ç–æ–≤—ã–π CSV —Ñ–∞–π–ª
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è
   - ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–§–∞–π–ª –ø–æ–ª—É—á–µ–Ω: ..."
   - ‚úÖ –ó–∞–¥–∞—ë—Ç—Å—è –≤–æ–ø—Ä–æ—Å –æ —Ä–∞–∑–º–µ—Ä–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Railway –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Supabase —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—Å–º. `docs/RAILWAY_SUPABASE_VARS_SETUP.md`)

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 13.11.2025  
**–§–∞–π–ª**: `bot/handlers/analytics.py`, —Å—Ç—Ä–æ–∫–∞ 486  
**–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

