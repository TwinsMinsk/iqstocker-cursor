# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ Railway

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∞:
```
ValueError: Missing required environment variables: SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY (or SUPABASE_KEY)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í Railway –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Supabase Storage.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway

### –®–∞–≥ 1: –ù–∞–π–¥–∏ Supabase credentials

1. –û—Ç–∫—Ä–æ–π **Supabase Dashboard**: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏ –≤ **Settings ‚Üí API**

### –®–∞–≥ 2: –°–∫–æ–ø–∏—Ä—É–π –∑–Ω–∞—á–µ–Ω–∏—è

–ù–∞–π–¥–∏ —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:

1. **Project URL** (—ç—Ç–æ `SUPABASE_URL`):
   ```
   https://xxxxx.supabase.co
   ```

2. **service_role key** (—ç—Ç–æ `SUPABASE_SERVICE_ROLE_KEY`):
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4eHh4Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTYxNjIzOTAyMiwiZXhwIjoxOTMxODE1MDIyfQ.xxxxx
   ```
   
   ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ò—Å–ø–æ–ª—å–∑—É–π **service_role key**, –∞ –ù–ï **anon public key**!
   - ‚úÖ **service_role key** ‚Äî –¥–ª—è Storage –æ–ø–µ—Ä–∞—Ü–∏–π (–∑–∞–ø–∏—Å—å/—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)
   - ‚ùå **anon public key** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Storage)

3. **Bucket name** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `csv-files`):
   ```
   csv-files
   ```

---

### –®–∞–≥ 3: –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway

1. –û—Ç–∫—Ä–æ–π **Railway Dashboard**: https://railway.app
2. –í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏ –≤ **Settings ‚Üí Variables** (–∏–ª–∏ **Shared Variables**)
4. –î–æ–±–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
SUPABASE_STORAGE_BUCKET=csv-files
```

(–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `csv-files` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

1. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Bot service:
   ```
   StorageService initialized with bucket: csv-files
   ```
3. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## üîç –ì–¥–µ –Ω–∞–π—Ç–∏ service_role key –≤ Supabase

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Dashboard

1. Supabase Dashboard ‚Üí Settings ‚Üí API
2. –ü—Ä–æ–∫—Ä—É—Ç–∏ –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ **"Project API keys"**
3. –ù–∞–π–¥–∏ **"service_role"** (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
4. –ù–∞–∂–º–∏ **"Reveal"** –∏–ª–∏ **"Show"** —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∫–ª—é—á
5. –°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ...`)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Settings ‚Üí General

1. Supabase Dashboard ‚Üí Settings ‚Üí General
2. –ü—Ä–æ–∫—Ä—É—Ç–∏ –≤–Ω–∏–∑ –¥–æ **"Reference ID"**
3. –†—è–¥–æ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **"API Keys"** ‚Üí –ø–µ—Ä–µ–π–¥–∏ —Ç—É–¥–∞
4. –ù–∞–π–¥–∏ **"service_role"** key

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. **service_role key ‚Äî –°–ï–ö–†–ï–¢–ù–´–ô!**

- ‚ùå **–ù–ï –∫–æ–º–º–∏—Ç—å** –≤ Git
- ‚ùå **–ù–ï –ø—É–±–ª–∏–∫—É–π** –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
- ‚úÖ –•—Ä–∞–Ω–∏ —Ç–æ–ª—å–∫–æ –≤ Railway Variables (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (Storage, Admin API)

### 2. **–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–ª—é—á–∞–º–∏:**

| –ö–ª—é—á | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –î–æ—Å—Ç—É–ø |
|------|---------------|--------|
| **anon public** | –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π) |
| **service_role** | –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (admin) |

**–î–ª—è Storage –æ–ø–µ—Ä–∞—Ü–∏–π (–∑–∞–ø–∏—Å—å/—É–¥–∞–ª–µ–Ω–∏–µ) –Ω—É–∂–µ–Ω `service_role`!**

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ bucket:**

–£–±–µ–¥–∏—Å—å, —á—Ç–æ bucket `csv-files` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:

1. Supabase Dashboard ‚Üí Storage
2. –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ bucket `csv-files`
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π:
   - Name: `csv-files`
   - Public: `false` (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
   - File size limit: `5MB` (–∏–ª–∏ –±–æ–ª—å—à–µ)
   - Allowed MIME types: `text/csv` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Bot service

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

**–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:**
```
StorageService initialized with bucket: csv-files
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
Missing required environment variables: ...
Failed to initialize Supabase Storage client: ...
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∑–∞–≥—Ä—É–∑–∫—É CSV

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –ü–µ—Ä–µ–π–¥–∏ –≤ "üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è"
3. –ó–∞–≥—Ä—É–∑–∏ —Ç–µ—Å—Ç–æ–≤—ã–π CSV —Ñ–∞–π–ª
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –§–∞–π–ª –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è
   - ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–§–∞–π–ª –ø–æ–ª—É—á–µ–Ω: ..."
   - ‚úÖ –ó–∞–¥–∞—ë—Ç—Å—è –≤–æ–ø—Ä–æ—Å –æ —Ä–∞–∑–º–µ—Ä–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
- –¢–µ–ø–µ—Ä—å —Ç—ã —É–≤–∏–¥–∏—à—å **—Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É** –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Railway –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å:

- [ ] `SUPABASE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Railway Variables
- [ ] `SUPABASE_SERVICE_ROLE_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Railway Variables
- [ ] `SUPABASE_STORAGE_BUCKET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `csv-files` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- [ ] Railway –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª —Å–µ—Ä–≤–∏—Å—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –í –ª–æ–≥–∞—Ö Bot service: `StorageService initialized with bucket: csv-files`
- [ ] –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CSV –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

---

## üî¥ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä—å 1: –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–∞

–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª **–≤–µ—Å—å** service_role key:
- –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `eyJ`
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–º (200+ —Å–∏–º–≤–æ–ª–æ–≤)
- –ù–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫

### –ü—Ä–æ–≤–µ—Ä—å 2: Bucket —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

1. Supabase Dashboard ‚Üí Storage
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ bucket `csv-files` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π –µ–≥–æ

### –ü—Ä–æ–≤–µ—Ä—å 3: Storage Policy –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: `docs/SUPABASE_POLICY_FIX.md`

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è policy –¥–ª—è –∑–∞–ø–∏—Å–∏:**
```sql
bucket_id = 'csv-files'
```

### –ü—Ä–æ–≤–µ—Ä—å 4: –õ–æ–≥–∏ Railway

–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Bot service –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫:
```
Failed to initialize Supabase Storage client: ...
Failed to upload CSV to Storage: ...
```

---

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SUPABASE_KEY

–ï—Å–ª–∏ `SUPABASE_SERVICE_ROLE_KEY` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SUPABASE_KEY` (anon key):

```bash
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...  # anon key
```

**–ù–û**: –≠—Ç–æ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Storage, –µ—Å–ª–∏ policy —Ç—Ä–µ–±—É–µ—Ç service_role key.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π `SUPABASE_SERVICE_ROLE_KEY` –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 13.11.2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

